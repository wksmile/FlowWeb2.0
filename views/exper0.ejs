<!DOCTYPE HTML>
<!--未加入Bootstrap的两行链接---->
<html lang="en" xmlns="http://www.w3.org/1999/html" style="text-align: center">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>实验界面</title>
    <link href="./images/favicon.ico" rel="shortcut icon">  <!--title的图标-->
    <!--------------------------------以下为模板的链接------------------------------------->
    <link href="stylesheets/topStrip.css"  rel="stylesheet" type="text/css">
    <link href="stylesheets/switch.css"  rel="stylesheet" type="text/css">
    <link href="stylesheets/bootstrap.css" rel="stylesheet" type="text/css">
    <link href="stylesheets/experNew.css" rel="stylesheet" type="text/css" media="screen">

    <script src="/jquery/dist/jquery.js"></script>
</head>

<!--加上auto居中-->
<body style = "margin:0 auto; width:1580px; text-align:left; " onload="updateFrequencyValue(); recordExpLog('进入实验');">

    <!-----顶部导航栏----->
    <div id="top" align="center" style="background:url(./images/common/top.png); position: relative">

        <li id="menu" class="menu" style="margin-left: 700px">
            <a href="#" id="buttonExpIntro" style="height:55px; line-height:55px; color:#ffffff">实验简介</a>
        </li>
        <li id="menuExp" class="menu">
            <div style="height:55px; line-height:55px">在线实验</div>
            <div class="list">
                <a class="menuItem" href="#">涡街流量计验证实验</a>
                <a class="menuItem" href="#">超声波液位计验证实验</a>
                <a class="menuItem" href="#">超声波流量计验证实验</a>
                <a class="menuItem" href="#">涡街流量计综合实验</a>
                <a class="menuItem" href="#">超声波液位计综合实验</a>
                <a class="menuItem" href="#">超声波流量计综合实验</a>
            </div>
        </li>
        <li id="menuReport" class="menu">
            <div style="height:55px; line-height:55px">实验报告</div>
            <div class="list">
                <a class="menuItem" href="/uploadReport" target="_blank">提交</a>
                <a class="menuItem" href="#">查看</a>
            </div>
        </li>
        <li class="menu">
            <a href="#" style="height:55px; line-height:55px; color:#ffffff">个人信息</a>
        </li>

        <div id="userName">
            <% if (locals.username) { %>
            <a href="#" style="color: #ddd; font-size: 1em;">
                <%= username %>
            </a>
            &nbsp;
            <a href="/logout" style="color: #ddd; font-size: 1em;">安全退出</a>
            <% } %>

        </div>
        <!-----回到主页链接--->
        <a href="/" target="_blank">
            <div align="center" style="position: absolute; left:200px; top:0px; width:350px; height:55px; z-index: 1000"></div>
        </a>
    </div>



    <div id="experiment" align="center" style="background:url(./images/common/exp.png) no-repeat; transform: translate(0,0); height:609px; width:1580px; position: relative">

        <div class="expTitle" style="font-size: 45px; font-weight: bold; color:#eeeeee; position: absolute; left:200px; top:40px;">涡街流量计验证实验</div>

        <!----图形化数据显示--->
        <div id="labelFlowRateVortex" style="position: absolute; left:200px; top:167px; color: #cccccc"></div>
        <div id="labelTotalFlowVortex" style="position: absolute; left:200px; top:182px; color: #cccccc"></div>

        <div id="labelFlowRateHM" style="position: absolute; left:200px; top:237px; color: #cccccc"></div>
        <div id="labelTotalFlowHM" style="position: absolute; left:200px; top:252px; color: #cccccc"></div>
        <div id="labelTempHM" style="position: absolute; left:200px; top:267px; color: #cccccc"></div>

        <div id= "labelWaterLevel" style="position: absolute; left:810px; top:87px; color: #cccccc"></div>
        <div id= "labelTempAir" style="position: absolute; left:810px; top:102px; color: #cccccc"></div>

        <div id="labelWeight" style="position: absolute; left:810px; top:287px; color: #cccccc"></div>
        <div id="labelFrequency" style="position: absolute; left:300px; top:439px; color: #cccccc"> </div>

        <span class="switch" style="position: absolute; left:1100px; top:283px;">
            <input id="sw1" type="checkbox" />
            <label for="sw1"></label>
        </span>

        <span class="switch" style="position: absolute; left:1100px; top:305px;">
            <input id="sw2" type="checkbox" />
            <label for="sw2"></label>
        </span>

        <span class="switch" style="position: absolute; left:1250px; top:283px;">
            <input id="sw3" type="checkbox" />
            <label for="sw3"></label>
        </span>

        <span class="switch" style="position: absolute; left:1250px; top:305px;">
            <input id="sw4" type="checkbox" />
            <label for="sw4"></label>
        </span>

        <div id="labelFlowRateVortexSide" style="position: absolute; left:1210px; top:475px; color: #cccccc"></div>
        <div id="labelFlowRateHMSide" style="position: absolute; left:1210px; top:498px; color: #cccccc"></div>
        <div id="labelWaterLevelSide" style="position: absolute; left:1210px; top:521px; color: #cccccc"></div>
        <div id="labelWeightSide" style="position: absolute; left:1210px; top:544px; color: #cccccc"></div>


        <div class="Slider" style="position: absolute; left:1150px; top:330px;">
            <div class="sRange"></div>
            <div class="sValidRange" id="sValidRange"></div>

            <input id = "frequencySlider" type="range" min="0" max="50" value="30" onmousemove = "updateFrequencyValue();">
        </div>
        <div id="labelFrequencySide" style="position: absolute; left:1302px; top:333px; white-space: nowrap; color: #cccccc"></div>
        <button id="buttonStartExperiment" class="btn-lg btn-default" style="position: absolute; left:1080px; top:355px; color: #222222">开始实验</button>
        <button id="buttonResetExperiment" class="btn-lg btn-default" style="position: absolute; left:1210px; top:355px; color: #222222">重置实验</button>

        <div style="position: absolute; left:1360px; top:190px; color: #eeeeee; font-size: 25px">实验日志</div>
        <div id="expLog" align="left" style="position: absolute; left:1360px; top:225px; width:200px; height:370px; background-color: rgba(200, 200, 200, 0.5); overflow-y: scroll;">

        </div>

    </div>

    <div id="charts" style = "width: 1580px; height: 350px; opacity: 50">
        <div id="divChartWeight" style="position: absolute; margin-left:100px; margin-top:20px; width:500px; height:300px; ">
            <!--质量曲线在此-->
        </div>

        <div id="divChartVortex" style="position: absolute; margin-left:600px; margin-top:20px; width:500px; height:300px; ">
            <!--涡街流量曲线在此-->
        </div>

        <script type="text/javascript" src="javascripts/chart.js"></script>

        <div id="divDataRecord" style="position: absolute; margin-left:1100px; margin-top:20px; width:480px; height:300px;  background-color: #dddddd">
            <h1 align="center" style="position:relative; font-size: 20px; top:-20px">实验数据记录</h1>
            <div id = "divDataTable" align="left" style="margin-left:20px; width: 60%; height:200px; overflow-y: scroll;">
                <table id="tableDataRecord" align="left" border="1" style="margin-left:0px; width: 95%;">
                    <tr>
                        <td align="center" style="font-weight: bolder">序号</td>
                        <td align="center" style="font-weight: bolder">时间</td>
                        <td align="center" style="font-weight: bolder">质量(kg)</td>
                        <td align="center" style="font-weight: bolder">涡街流量(m3/h)</td>
                    </tr>
                </table>
            </div>

            <button id="buttonStartRecord" class="btn-lg btn-default" style="position: absolute; left:350px; top:50px; color: #222222">开始记录</button>
            <button id="buttonClearRecord" class="btn-lg btn-default" style="position: absolute; left:350px; top:100px; color: #222222">清空表格</button>

            <div style="position: absolute; left:350px; top:150px; font-size: 15px">采样间隔</div>
            <input id="inputSampleInterval" onkeyup="recordIntervalChange()" type="text" value="1" style=" position:absolute; left:410px; top:150px; width:30px;font-family:inherit;border:2px solid #CCC;margin:0 5px;padding:0px;" />
            <div style="position:absolute; left:450px; top:150px; width:50px;">s</div>

            <button id="buttonPauseGraph" class="btn-lg btn-default" style="position: absolute; left:350px; top:180px; color: #222222">暂停曲线</button>
        </div>
    </div>

    <div id="bottom" align="center" style="background:url(./images/common/bottom.png) no-repeat; height:240px; width:1580px"></div>

    <div id="Warnings">
        <div id="WarningOverflow"  class="warning" align="center" style="background:url(./images/common/warning.png) no-repeat; height:320px; width:440px">
            <h1 style="position:relative; top: 20px; font-size: 50px; font-weight: bolder;">
                警告
            </h1>
            <p class="p_warning" align="center">上储水槽液位超限</p>
            <p class="p_warning" align="center">已自动打开出水阀</p>
            <p class="p_warning" align="center">并停止离心泵</p>

            <button class="btn-lg btn-default" id="OverflowOK" style="height: 50px;">确定</button>


        </div>

        <div id="WarningResetFinished"  class="warning" align="center" style="background:url(./images/common/warning.png) no-repeat; height:320px; width:440px">
            <h1 style="position:relative; top: 40px; font-size: 50px; font-weight: bolder;">
                提示
            </h1>
            <p class="p_warning" align="center"><br/></p>
            <p class="p_warning" align="center">上水槽已清空</p>
            <p class="p_warning" align="center">可以开始实验</p>

            <button class="btn-lg btn-default" id="resetFinishedOK" style="height: 50px;">确定</button>


        </div>
    </div>

    <div id="experimentIntroduction" class="instrumentIntro" align="center" style="height: 500px;">
        <h1>
            实验简介
        </h1>
        <hr style="width: 700px; height:1px"/>

        <p align="left" class="instrumentIntroParagraph">
            本次实验为涡街流量计验证实验，实验目的是使用电子秤作为校准源，对涡街流量计进行校准。
        </p>
        <h2 align="left" style="font-weight: bolder; font-size: 30px">实验原理</h2>
        <p align="left" class="instrumentIntroParagraph">
            基于质量法流量标定实验现场区组成如图所示，系统启动后，打开换向器2、关闭换向器1，控制器发送命令将电子秤计时清零，当管道中流量稳定后；
            打开换向器1、关闭换向器2和泄流阀，流体流入称量容器中。计时一段时间后，读取流体的总质量，通过计算就可得知这段时间的平均流量，也可以实时记录测量过程中流量的动态变化曲线。
            在使用质量法测量平均流量曲线的时间段内，实时读取被校流量仪表的流量曲线，通过对比算法可以对仪表测量精确性和稳定性进行评估。
        </p>
        <img src="./images/experiment0/1.png"; width="500px"  align="center"/>
        <h2 align="left" style="font-weight: bolder; font-size: 30px">实验内容</h2>
        <p align="left" class="instrumentIntroParagraph">
            在首页导航栏上点击，可以看到如下图所示界面。每个区域功能均已标注在图中。
        </p>
        <img src="./images/experiment0/2.png"; width="500px"  align="center"/>
        <p align="left" class="instrumentIntroParagraph">
            实验开始前，先熟悉设备使用。控制面板区有阀门和变频器的开关，以及控制变频器频率的滑块。屏幕下方两个曲线区域实时显示质量和流量曲线。曲线图每隔1秒刷新一次。
            如果需要临时暂停曲线图以便读取数据或者截图，可以按实验数据记录区右侧的“暂停曲线”按钮。
        </p>
        <p align="left" class="instrumentIntroParagraph">
            首先打开阀门A，关闭其他两个阀门，将变频器设置为默认的30Hz。按下变频器启动开关并观察曲线图。此时可以发现，流量计曲线会升高并稳定在一个值附近。而质量曲线图会持续升高。
        </p>
        <p align="left" class="instrumentIntroParagraph">
            按下数据表格区右侧的“开始记录”按钮，则数据表格会根据设置的采样间隔，定时将数据添加在表格中。采样间隔可调范围为1-10秒。开始记录数据后，开始按钮变为停止按钮。
            此时再按一下，则停止记录数据。可以将数据选择复制至excel或者其他数据分析软件中，以便实验后的数据分析和保存。
        </p>
        <p align="left" class="instrumentIntroParagraph">
            控制面板的“重置实验”按钮用于自动清空上容器的水。相当于取代了人为的阀门操作。清空完成时系统会发出提示。
            控制面板的“开始实验”按钮用于自动开始实验步骤，也相当于取代了手工打开阀门及变频器。
        </p>
        <p align="left" class="instrumentIntroParagraph">
            在熟悉设备后，即可正式开始实验。首先重置实验设备，清空数据表格。
        </p>
        <p align="left" class="instrumentIntroParagraph">
            实验设备重置完成后，将变频器频率设置为20Hz，点击开始实验。此时折线图会自动清空。随后每隔1秒更新一次数据。选择好合适的数据采样时间间隔，
            待涡街流量计曲线稳定时点击表格区的“开始记录”按钮，记录一组质量-流量数据。实验中要注意容器质量不能超过20kg，以避免溢出。如果容器质量达到20kg，
            系统会发出警报并自动关闭水泵，打开出水阀门。
        </p>
        <p align="left" class="instrumentIntroParagraph">
            20Hz的实验完成后，再以30Hz、40Hz和50Hz分别进行上述实验步骤，记录下3组数据。数据记录完成后，点击“结束实验”按钮，结束实验，并关闭页面。系统会自动记录本次实验的过程。
        </p>

        <h2 align="left" style="font-weight: bolder; font-size: 30px">实验数据分析</h2>
        <p align="left" class="instrumentIntroParagraph">
            实验数据分析可用Excel完成。实验中记录了4组质量-流量数据。将数据导入Excel。选中质量数据，计算每两个质量之间的差值。除以采样时间间隔，即可计算出质量法测得的标准流量。
            将计算出的标准流量和涡街流量计的流量进行单位统一化，并且比较数据的差值。
        </p>
        <p align="left" class="instrumentIntroParagraph">
            分析不同流量下标准流量和涡街流量计实测流量的关系，完成实验报告。
        </p>
    </div>

    <div id="InstrumentIntroductions">
        <div id="UltraSonicFlowmeter" class="instrumentIntro" align="center">
            <h1>
                超声波流量计
            </h1>
            <hr style="width: 700px;"/>
            <img src="./images/Instruments/HeatMeter.jpg"; width="300px"  align="center"/>

            <p align="left" class="instrumentIntroParagraph">
超声波流量计是一种非接触式仪表，它既可以测量大管径的介质流量也可以用于不易接触和观察的介质的测量。它的测量准确度很高，几乎不受被测介质的各种参数的干扰，尤其可以解决其它仪表不能的强腐蚀性、非导电性、放射性及易燃易爆介质的流量测量问题。
            </p>
            <p align="left" class="instrumentIntroParagraph">
                超声波流量计采用时差式测量原理：一个探头发射信号穿过管壁、介质、另一侧管壁后，被另一个探头接收到，同时，第二个探头同样发射信号被第一个探头接收到，由于受到介质流速的影响，二者存在时间差Δt，根据推算可以得出流速V和时间差Δt之间的换算关系V=(C2/2L)×Δt，进而可以得到流量值Q
            </p>

            <p align="left" class="instrumentIntroParagraph">
                本实验中使用的是超声波热能表，它在超声波流量计的基础上增加了入口温度探头和出口温度探头，并同时具有软件计量功能，可以通过流量和温度差计算流经发热器的热能损耗，进而计算价格。不过在本实验中，仅使用了热能表的流量数据。
            </p>
        </div>

        <div id="UltraSonicDistance" class="instrumentIntro" align="center">
            <h1>
                超声波液位传感器
            </h1>
            <hr style="width: 700px;"/>
            <img src="./images/Instruments/UltraSonic.jpg"; width="300px"  align="center"/>

            <p align="left" class="instrumentIntroParagraph">
                超声波测距原理是在超声波发射装置发出超声波，它的根据是接收器接到超声波时的时间差，与雷达测距原理相似。
            </p>

            <p align="left" class="instrumentIntroParagraph">
            超声波指向性强，在介质中传播的距离较远，因而超声波经常用于距离的测量，如测距仪和物 位测量仪等都可以通过超声波来实现。利用超声波检测往往比较迅速、方便、计算简单、易于做到实时控制，并且在测量精度方面能达到工业实用的要求，因此在移 动机器人的研制上也得到了广泛的应用。
            </p>

            <p align="left" class="instrumentIntroParagraph">
                通过超声波发射装置发出超声波，根据接收器接到超声波时的时间差就可以知道距离了。这与雷达测距原理相似。 超声波发射器向某一方向发射超声波，在发射时刻的同时开始计时，超声波在空气中传播，途中碰到障碍物就立即返回来，超声波接收器收到反射波就立即停止计时。（超声波在空气中的传播速度为340m/s，根据计时器记录的时间t，就可以计算出发射点距障碍物的距离(s)，即：s=340t/2）
            </p>

            <p align="left" class="instrumentIntroParagraph">
                本实验中使用超声波测距传感器检测上储水槽的液位。传感器垂直安装在储水槽上方，检测液面与传感器间的距离。要获得实际的液位值需从传感器与水槽底部的距离上减去传感器测得的实际距离。
            </p>
        </div>

        <div id="VortexMeter" class="instrumentIntro" align="center">
            <h1>
                涡街流量计
            </h1>
            <hr style="width: 700px;"/>
            <img src="./images/Instruments/Vortex.jpg" width="300px"  align="center"/>

            <p align="left" class="instrumentIntroParagraph">
                涡街流量计是根据卡门（Karman）涡街原理研究生产的，主要用于工业管道介质流体的流量测量，如气体、液体、蒸汽等多种介质。其特点是压力损失小，量程范围大，精度高，在测量工况体积流量时几乎不受流体密度、压力、温度、粘度等参数的影响。无可动机械零件，因此可靠性高，维护量小。仪表参数能长期稳定。涡街流量计采用压电应力式传感器，可靠性高，可在-20℃～+250℃的工作温度范围内工作。有模拟标准信号，也有数字脉冲信号输出，容易与计算机等数字系统配套使用，是一种比较先进、理想的测量仪器。                      </p>

            <p align="left" class="instrumentIntroParagraph">
                在流体中设置三角柱型旋涡发生体，则从旋涡发生体两侧交替地产生有规则的旋涡，这种旋涡称为卡门旋涡，旋涡列在旋涡发生体下游非对称地排列。
                涡街流量计是根据卡门涡街原理(Kármán Vortex Street)测量气体、蒸汽或液体的体积流量、标况的体积流量或质量流量的体积流量计。并可作为流量变送器应用于自动化控制系统中。
                涡街流量计是应用流体振荡原理来测量流量的，流体在管道中经过涡街流量变送器时，在三角柱的旋涡发生体后上下交替产生正比于流速的两列旋涡，旋涡的释放频率与流过旋涡发生体的流体平均速度及旋涡发生体特征宽度有关，可用下式表示：
                <br>
                <img src="./images/Instruments/v1.jpg" align="center"/>
                <br>
                式中：f为旋涡的释放频率，单位为Hz；v为流过旋涡发生体的流体平均速度，单位为m/s；d为旋涡发生体特征宽度，单位为m；St为斯特劳哈尔数（Strouhal number），无量纲，它的数值范围为0.14－0.27。
                St是雷诺数的函数，<img src="./images/Instruments/v2.jpg"/>。<br>
                当雷诺数Re在<img src="./images/Instruments/v3.jpg"/>范围内，St值约为0.2。在测量中，要尽量满足流体的雷诺数在<img src="./images/Instruments/v3.jpg"/>，此时旋涡频率<img src="./images/Instruments/v4.jpg"/>。
                由此，通过测量旋涡频率就可以计算出流过旋涡发生体的流体平均速度v，再由式<img src="./images/Instruments/v5.jpg"/>可以求出流量q，其中A为流体流过旋涡发生体的截面积。
            </p>

        </div>
    </div>

    <div id="LiveInstruments">
        <div id="UltraSonicFlowmeterLive" style="position: absolute; left:0; top:0; width: 660px; display:none">
            <img src="./images/LiveInstrument/UltrasonicFlowmeter.png"/>

            <!----温度---->
            <img                     src="./images/LCD/dot.png" style="position: absolute; left:265px; top:80px; width: 25px"/>
            <img id="USFlowTempDigit1" src="./images/LCD/_.png" style="position: absolute; left:225px; top:80px; width: 25px"/>
            <img id="USFlowTempDigit2" src="./images/LCD/_.png" style="position: absolute; left:250px; top:80px; width: 25px"/>
             <img id="USFlowTempDigit3" src="./images/LCD/_.png" style="position: absolute; left:280px; top:80px; width: 25px"/>
            <img id="USFlowTempDigit4" src="./images/LCD/_.png" style="position: absolute; left:305px; top:80px; width: 25px"/>

            <!----T1---->
            <img  src="./images/LCD/_.png" style="position: absolute; left:192px; top:118px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:212px; top:118px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:232px; top:118px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:252px; top:118px; width: 20px"/>

            <!----T2---->
            <img  src="./images/LCD/_.png" style="position: absolute; left:385px; top:118px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:405px; top:118px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:425px; top:118px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:445px; top:118px; width: 20px"/>


            <!----流量---->
            <img           src="./images/LCD/dot.png" style="position: absolute; left:300px; top:150px; width: 30px"/>
            <img id="USFlowDigit1" src="./images/LCD/1.png" style="position: absolute; left:250px; top:150px; width: 30px"/>
            <img id="USFlowDigit2" src="./images/LCD/2.png" style="position: absolute; left:280px; top:150px; width: 30px"/>
            <img id="USFlowDigit3" src="./images/LCD/3.png" style="position: absolute; left:320px; top:150px; width: 30px"/>
            <img id="USFlowDigit4" src="./images/LCD/4.png" style="position: absolute; left:350px; top:150px; width: 30px"/>
            <!--img id="USFlowDigit5" src="./images/LCD/8.png" style="position: absolute; left:360px; top:150px; width: 30px"/-->


        </div>

        <div id="VortexLive" style="position: absolute; left:0; top:0; width: 500px; display:none">
            <img src="./images/LiveInstrument/Vortex.png"/>

            <img  src="./images/LCD/_.png" style="position: absolute; left:195px; top:168px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:215px; top:168px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:235px; top:168px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:255px; top:168px; width: 20px"/>
            <img  src="./images/LCD/_.png" style="position: absolute; left:275px; top:168px; width: 20px"/>


            <!----流量---->
            <img           src="./images/LCD/dot.png" style="position: absolute; left:213px; top:214px; width: 20px"/>
            <img id="VortexFlowDigit1" src="./images/LCD/_.png" style="position: absolute; left:177px; top:214px; width: 20px"/>
            <img id="VortexFlowDigit2" src="./images/LCD/_.png" style="position: absolute; left:197px; top:214px; width: 20px"/>
            <img id="VortexFlowDigit3" src="./images/LCD/_.png" style="position: absolute; left:227px; top:214px; width: 20px"/>
            <img id="VortexFlowDigit4" src="./images/LCD/_.png" style="position: absolute; left:247px; top:214px; width: 20px"/>
            <!--img id="VortexFlowDigit5" src="./images/LCD/_.png" style="position: absolute; left:257px; top:214px; width: 20px"/-->

        </div>
    </div>

    <div id = "liveVideo" style="position:absolute; left:1053px; top:98px;">
        <canvas id="video-canvas" style = "width: 293px; height: 181px"></canvas>
    </div>





    <div id="bottom" align="center" style="background:url(./images/common/bottom_empty.jpg) no-repeat; height:240px; width:1580px; position:absolute; top:1000px;">
        <div class="all">
            <div class="b_text">
                <h6>介绍</h6>
                <ul>
                    <li><a href="#">关于我们</a></li>
                    <li><a href="#">联系我们</a></li>
                    <li><a href="#">加入我们</a></li>
                    <li><a href="#">技术支持</a></li>
                </ul>
            </div>
            <div class="b_text">
                <h6>合作</h6>
                <ul>
                    <li><a href="#">新加课程</a></li>
                    <li><a href="#">高校合作</a></li>
                    <li><a href="#">友情链接</a></li>
                </ul>
            </div>
            <div class="b_text">
                <h6>服务</h6>
                <ul>
                    <li><a href="#">在线实验</a></li>
                    <li><a href="#">注册登录</a></li>
                    <li><a href="#">实验报告</a></li>
                    <li><a href="#">实验评分</a></li>
                    <li><a href="#">常见问题</a></li>
                </ul>
            </div>
            <div class="b_text">
                <h6>学习路径</h6>
                <ul>
                    <li><a href="#">原理介绍</a></li>
                    <li><a href="#">传感器介绍</a></li>
                    <li><a href="#">实验报告</a></li>
                    <li><a href="#">实验评分</a></li>
                </ul>
            </div>
        </div>

        <div class="power">COPYRIGHT@2016-2018 东南大学检测技术研究所</div>
    </div>



    <!----------------------------------------- Javascripts----------------------------------------->
    <script>

            function addZero(n)
            {
                if(n<10) return "0" + n;
                return n;
            }
            function recordExpLog(text)
            {
                var date = new Date();
                var y = date.getFullYear();
                var m = addZero(date.getMonth()+1);
                var d = addZero(date.getDate());
                var h = addZero(date.getHours());
                var min = addZero(date.getMinutes());
                var s = addZero(date.getSeconds());

                document.getElementById('expLog').innerText += y + "-" + m + "-" + d + "  " + h + ":" + min + ":" + s + "\r\n";
                document.getElementById('expLog').innerText +=  "<" + text + ">\r\n";

                //滚至最底部
                document.getElementById("expLog").scrollTop = document.getElementById("expLog").scrollHeight;
            }
        </script>

    <script>

        window.onbeforeunload = function()
        {
            return 1;//阻止意外关闭实验页
        }

        //窗口关闭时,使用ajax上传实验日志
        window.onunload = function()
        {
            recordExpLog('退出实验');
            $.ajax({
                type: 'POST',
                async: false,
                url: '/exper0',
                data: 'log=' + document.getElementById('expLog').innerText
            });
        }


    </script>

    <div class="misc">

            <!----主实验界面鼠标事件------>
            <script>

                const ULTRAFLOW_X1 = 308;
                const ULTRAFLOW_X2 = 370;
                const ULTRAFLOW_Y1 = 317;
                const ULTRAFLOW_Y2 = 360;

                const ULTRADIST_X1 = 648;
                const ULTRADIST_X2 = 675;
                const ULTRADIST_Y1 = 161;
                const ULTRADIST_Y2 = 191;

                const VORTEX_X1 = 420;
                const VORTEX_X2 = 486;
                const VORTEX_Y1 = 275;
                const VORTEX_Y2 = 364;

                function hideInstrumnts()
                {
                    document.getElementById("UltraSonicFlowmeterLive").style.display = "none";
                    document.getElementById("VortexLive").style.display = "none";
                }

                function hideInstrumentIntroductions()
                {
                    //隐藏所有信息显示窗口
                    document.getElementById("UltraSonicFlowmeter").style.visibility = "hidden";
                    document.getElementById("UltraSonicFlowmeter").style.opacity = "0";
                    document.getElementById("UltraSonicFlowmeter").style.transition = "visibility 0s ease-in-out 0.2s,opacity 0.2s ease-in-out";
                    document.getElementById("UltraSonicFlowmeter").style.zIndex = "500";

                    document.getElementById("UltraSonicDistance").style.visibility = "hidden";
                    document.getElementById("UltraSonicDistance").style.opacity = "0";
                    document.getElementById("UltraSonicDistance").style.transition = "visibility 0s ease-in-out 0.2s,opacity 0.2s ease-in-out";
                    document.getElementById("UltraSonicDistance").style.zIndex = "500";

                    document.getElementById("VortexMeter").style.visibility = "hidden";
                    document.getElementById("VortexMeter").style.opacity = "0";
                    document.getElementById("VortexMeter").style.transition = "visibility 0s ease-in-out 0.2s,opacity 0.2s ease-in-out";
                    document.getElementById("VortexMeter").style.zIndex = "500";

                    document.getElementById("experimentIntroduction").style.visibility = "hidden";
                    document.getElementById("experimentIntroduction").style.opacity = "0";
                    document.getElementById("experimentIntroduction").style.transition = "visibility 0s ease-in-out 0.2s,opacity 0.2s ease-in-out";
                    document.getElementById("experimentIntroduction").style.zIndex = "500";
                }

                function setButtonsByStatus()
                {
                    switch (experimentStatus)
                    {
                        case 0:
                            document.getElementById("buttonStartExperiment").innerText = "开始实验";
                            break;
                        case 1:
                            document.getElementById("buttonStartExperiment").innerText = "停止实验";
                            break;
                        case 2:
                            document.getElementById("buttonStartExperiment").innerText = "开始实验";
                            break;
                        default:
                            document.getElementById("buttonStartExperiment").innerText = "开始实验";
                            experimentStatus = 0;
                    }
                };

                //鼠标移动至相应传感器位置时,显示放大的传感器实时画面
                $("#experiment").mousemove(function(e)
                {
                    var x=e.pageX;
                    var y=e.pageY;
                    var m_x = x - document.getElementById("experiment").offsetLeft;//当浏览器窗口宽度比页面宽度大时,中间的内容会有偏差,需要校正

                    //console.log("x:" + x + "  y:" + y);

                    if(m_x>ULTRAFLOW_X1 && m_x<ULTRAFLOW_X2 && y>ULTRAFLOW_Y1 && y<ULTRAFLOW_Y2)
                    {
                        document.getElementById("experiment").style.cursor = "Pointer";

                        //实时仪器跟踪鼠标
                        document.getElementById("UltraSonicFlowmeterLive").style.display = "block";
                        document.getElementById("UltraSonicFlowmeterLive").style.left = parseInt(x) + "px";
                        document.getElementById("UltraSonicFlowmeterLive").style.top = (parseInt(y) + 20) + "px";
                    }
                    else if(m_x>ULTRADIST_X1 && m_x<ULTRADIST_X2 && y>ULTRADIST_Y1 && y<ULTRADIST_Y2)
                    {
                        document.getElementById("experiment").style.cursor = "Pointer";

                    }
                    else if(m_x>VORTEX_X1 && m_x<VORTEX_X2 && y>VORTEX_Y1 && y<VORTEX_Y2)
                    {
                        document.getElementById("experiment").style.cursor = "Pointer";

                        document.getElementById("VortexLive").style.display = "block";
                        document.getElementById("VortexLive").style.left = (parseInt(x) + 20)+ "px";
                        document.getElementById("VortexLive").style.top = (parseInt(y) - 100) + "px";
                    }
                    else
                    {
                        hideInstrumnts();
                        document.getElementById("experiment").style.cursor = "Default";

                    }
                });

                //点击实验界面相应位置时,弹框显示传感器原理界面
                $('#experiment').click(function(e)
                {

                    var x=e.pageX - document.getElementById("experiment").offsetLeft;
                    var y=e.pageY;
                    if(x>ULTRAFLOW_X1 && x<ULTRAFLOW_X2 && y>ULTRAFLOW_Y1 && y<ULTRAFLOW_Y2)
                    {
                        hideInstrumnts();
                        hideInstrumentIntroductions();
                        document.getElementById("UltraSonicFlowmeter").style.visibility = "visible";
                        document.getElementById("UltraSonicFlowmeter").style.opacity = "1";
                        document.getElementById("UltraSonicFlowmeter").style.transition = "visibility 0s, opacity 0.2s ease-in-out";
                        document.getElementById("UltraSonicFlowmeter").style.zIndex = "1000";
                    }
                    else if(x>ULTRADIST_X1 && x<ULTRADIST_X2 && y>ULTRADIST_Y1 && y<ULTRADIST_Y2)
                    {
                        hideInstrumnts();
                        hideInstrumentIntroductions();
                        document.getElementById("UltraSonicDistance").style.visibility = "visible";
                        document.getElementById("UltraSonicDistance").style.opacity = "1";
                        document.getElementById("UltraSonicDistance").style.transition = "visibility 0s, opacity 0.2s ease-in-out";
                        document.getElementById("UltraSonicDistance").style.zIndex = "1000";

                    }
                    else if(x>VORTEX_X1 && x<VORTEX_X2 && y>VORTEX_Y1 && y<VORTEX_Y2)
                    {
                        hideInstrumnts();
                        hideInstrumentIntroductions();
                        document.getElementById("VortexMeter").style.visibility = "visible";
                        document.getElementById("VortexMeter").style.opacity = "1";
                        document.getElementById("VortexMeter").style.transition = "visibility 0s, opacity 0.2s ease-in-out";
                        document.getElementById("VortexMeter").style.zIndex = "1000";

                    }
                    else
                    {
                        hideInstrumentIntroductions();
                    }
                });

                $('#OverflowOK').click(function(e)
                {
                    document.getElementById("WarningOverflow").style.visibility = "hidden";
                    document.getElementById("WarningOverflow").style.opacity = "0";
                    document.getElementById("WarningOverflow").style.transition = "visibility 0s ease-in-out 0.2s,opacity 0.2s ease-in-out";
                    document.getElementById("WarningOverflow").style.zIndex = "500";
                });

                $('#resetFinishedOK').click(function(e)
                {
                    document.getElementById("WarningResetFinished").style.visibility = "hidden";
                    document.getElementById("WarningResetFinished").style.opacity = "0";
                    document.getElementById("WarningResetFinished").style.transition = "visibility 0s ease-in-out 0.2s,opacity 0.2s ease-in-out";
                    document.getElementById("WarningResetFinished").style.zIndex = "500";
                });


                $("#buttonExpIntro").click(function(e)
                {
                    hideInstrumnts();
                    hideInstrumentIntroductions();
                    document.getElementById("experimentIntroduction").style.visibility = "visible";
                    document.getElementById("experimentIntroduction").style.opacity = "1";
                    document.getElementById("experimentIntroduction").style.transition = "visibility 0s, opacity 0.2s ease-in-out";
                    document.getElementById("experimentIntroduction").style.zIndex = "1000";
                });

                //开始实验,清空表格,打开进水阀,关闭出水阀/侧阀,开启变频器
                $('#buttonStartExperiment').click(function(e)
                {
                    if(experimentStatus!=1)//停止状态
                    {
                        experimentStatus = 1;
                        socket.emit('startExperiment', document.getElementById('frequencySlider').value);

                        chartWeight.series[0].remove();
                        chartWeight.addSeries(createEmptySeries());
                        chartVortex.series[0].remove();
                        chartVortex.addSeries(createEmptySeries());
                        time = 0;
                        recordExpLog('开始实验');
                    }
                    else
                    {
                        experimentStatus = 0;
                        socket.emit('stopExperiment');
                        recordExpLog('结束实验');
                    }

                    setButtonsByStatus();
                });

                //重置实验,停止水泵,打开出水阀
                $('#buttonResetExperiment').click(function(e)
                {
                    experimentStatus = 2;
                    setButtonsByStatus();
                    socket.emit('resetExperiment');
                    recordExpLog('重置实验');
                });


                var isDrawingGraph = true;
                $('#buttonPauseGraph').click(function(e)
                {
                    isDrawingGraph = !isDrawingGraph;
                    document.getElementById("buttonPauseGraph").innerText = isDrawingGraph?"暂停曲线":"开始曲线";
                });

            </script>

            <!-------实时视频窗口--------->
            <script type="text/javascript">
                var max = false;
                $("#video-canvas").click(function(e){
                    max = !max;
                    if(max)
                    {
                        document.getElementById("video-canvas").style.width = "1112px";
                        document.getElementById("video-canvas").style.height = "800px";
                        document.getElementById("liveVideo").style.left = "234px";

                    }
                    else
                    {
                        document.getElementById("video-canvas").style.width = "293px";
                        document.getElementById("video-canvas").style.height = "181px";
                        document.getElementById("liveVideo").style.left = "1053px";

                    }
                });
            </script>

        </div>

    <div class="tableOperations">
            <script>

                var recordingIndex = 0;
                //清空表格按钮
                $('#buttonClearRecord').click(function(e){
                    recordingIndex = 0;
                    $("#tableDataRecord").empty();//清除所有内容
                    //添加表格标题行
                    var row = document.getElementById("tableDataRecord").insertRow();
                    var cell;
                    cell = row.insertCell(-1);
                        cell.innerHTML = "序号";
                        cell.align = "center";
                        cell.style = "font-weight: bolder";

                    cell = row.insertCell(-1);
                        cell.innerHTML = "时间";
                        cell.align = "center";
                        cell.style = "font-weight: bolder";

                    cell = row.insertCell(-1);
                        cell.innerHTML = "质量(kg)";
                        cell.align = "center";
                        cell.style = "font-weight: bolder";

                    cell = row.insertCell(-1);
                        cell.innerHTML = "涡街流量(m3/h)";
                        cell.align = "center";
                        cell.style = "font-weight: bolder";

                    recordExpLog('清空表格');
                });

                var isRecordingTable= false;
                $("#buttonStartRecord").click(function(e){
                    isRecordingTable = !isRecordingTable;
                    document.getElementById("buttonStartRecord").innerText = isRecordingTable?"停止记录":"开始记录";
                    if(isRecordingTable)recordExpLog('开始记录数据,间隔:' + recordInterval + 's');
                    else recordExpLog('停止记录数据');
                });

                //表格更新时间间隔
                function recordIntervalChange()
                {
                    var interval = parseInt($("#inputSampleInterval").val());
                    if(isNaN($("#inputSampleInterval").val()))document.getElementById("inputSampleInterval").value = 1;
                    if(interval>10)document.getElementById("inputSampleInterval").value = 10;
                    if(interval<1)document.getElementById("inputSampleInterval").value = 1;
                    recordInterval = parseInt($("#inputSampleInterval").val());
                    recordIntervalCounter = recordInterval;
                }

            </script>
        </div>

    <div class="highcharts">
            <script src="/jquery/dist/jquery.js"></script>
            <script src="/highcharts/highcharts.js"></script>
            <script src="/highcharts/modules/exporting.js"></script>
    </div>

    <div class="socket.IO">
        <script src="/socket.io/socket.io.js"></script>
        <script type="text/javascript" src="/javascripts/jsmpeg.min.socket.js"></script>

        <script type="text/javascript">
                var canvas = document.getElementById('video-canvas');
                var player = new JSMpeg.Player('Socket.IO', {canvas: canvas, channel: 1});
        </script>

        <script>
                var socket = io.connect();
                var time = 0;
                var recordInterval = 1;
                var recordIntervalCounter = 1;

                var lastSW1, lastSW2, lastSW3, lastSW4;

                var experimentStatus = 0;//实验状态,0:空闲(停止);1:正在实验;2:正在重置
                socket.on("Data Pack", function(temperature, ultraTime, distance, flowRate, totalFlowVortex, weight, temperatureWater,
                                                flowRateHM, totalFlowHM, valveIn, valveOut, valveSide, inverter){
                    if(true) {

                        //电子秤
                        document.getElementById('labelWeight').innerHTML = '质量:' + weight + ' kg';
                        document.getElementById('labelWeightSide').innerHTML = '质量:' + weight + ' kg';
                        //涡街流量计
                        document.getElementById('labelFlowRateVortex').innerHTML = '瞬时流量:' + flowRate + ' m3/h';
                        document.getElementById('labelFlowRateVortexSide').innerHTML = '瞬时流量:' + flowRate + ' m3/h';
                        document.getElementById('labelTotalFlowVortex').innerHTML = '累积流量:' + totalFlowVortex + ' m3';

                        document.getElementById("VortexFlowDigit1").src = "./images/LCD/" + parseInt((flowRate/10)%10) + ".png";
                        document.getElementById("VortexFlowDigit2").src = "./images/LCD/" + parseInt((flowRate)%10) + ".png";
                        document.getElementById("VortexFlowDigit3").src = "./images/LCD/" + parseInt((flowRate*10)%10) + ".png";
                        document.getElementById("VortexFlowDigit4").src = "./images/LCD/" + parseInt((flowRate*100)%10) + ".png";
                        //document.getElementById("VortexFlowDigit5").src = "./images/LCD/" + parseInt((flowRate*1000)%10) + ".png";


                        //超声波流量计
                        document.getElementById('labelFlowRateHM').innerHTML = '瞬时流量:' + flowRateHM + ' m3/h';
                        document.getElementById('labelFlowRateHMSide').innerHTML = '瞬时流量:' + flowRateHM + ' m3/h';
                        document.getElementById('labelTotalFlowHM').innerHTML = '累积流量:' + totalFlowHM + ' m3';
                        document.getElementById('labelTempHM').innerHTML = '水温:' + temperatureWater + ' C';

                         document.getElementById("USFlowDigit1").src = "./images/LCD/" + parseInt((flowRateHM/10)%10) + ".png";
                         document.getElementById("USFlowDigit2").src = "./images/LCD/" + parseInt((flowRateHM)%10) + ".png";
                         document.getElementById("USFlowDigit3").src = "./images/LCD/" + parseInt((flowRateHM*10)%10) + ".png";
                        document.getElementById("USFlowDigit4").src = "./images/LCD/" + parseInt((flowRateHM*100)%10) + ".png";
                        //document.getElementById("USFlowDigit5").src = "./images/LCD/" + parseInt((flowRateHM*1000)%10) + ".png";

                        document.getElementById("USFlowTempDigit1").src = "./images/LCD/" + parseInt((temperatureWater/10)%10) + ".png";
                        document.getElementById("USFlowTempDigit2").src = "./images/LCD/" + parseInt((temperatureWater)%10) + ".png";
                        document.getElementById("USFlowTempDigit3").src = "./images/LCD/" + parseInt((temperatureWater*10)%10) + ".png";
                        document.getElementById("USFlowTempDigit4").src = "./images/LCD/" + parseInt((temperatureWater*100)%10) + ".png";
                        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                        //超声波液位计
                        document.getElementById('labelWaterLevel').innerHTML = '液位:' + distance + ' mm';
                        document.getElementById('labelWaterLevelSide').innerHTML = '液位:' + distance + ' mm';
                        document.getElementById('labelTempAir').innerHTML = '气温:' + temperature + ' C';
                        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                        if(valveIn=='on' && lastSW1)document.getElementById('sw1').checked = true;
                        if(valveIn=='off' && !lastSW1)document.getElementById('sw1').checked = false;

                        if(valveSide=='on' && lastSW2)document.getElementById('sw2').checked = true;
                        if(valveSide=='off' && !lastSW2)document.getElementById('sw2').checked = false;

                        if(valveOut=='on' && lastSW3)document.getElementById('sw3').checked = true;
                        if(valveOut=='off' && !lastSW3)document.getElementById('sw3').checked = false;

                        if(inverter=='on' && lastSW4)document.getElementById('sw4').checked = true;
                        if(inverter=='off' && !lastSW4)document.getElementById('sw4').checked = false;

                        lastSW1 = valveIn=='on';
                        lastSW2 = valveSide=='on';
                        lastSW3 = valveOut=='on';
                        lastSW4 = inverter=='on';

                        //重置仪器终止判断
                        if(experimentStatus==2 && weight<1)
                        {
                            experimentStatus = 0;//切换为闲置状态
                            //等待10s,确保水放完,然后弹框提示,并关闭下水阀
                            setTimeout(function(){
                                socket.emit('controlValves', 'out',false);
                                document.getElementById("WarningResetFinished").style.visibility = "visible";
                                document.getElementById("WarningResetFinished").style.opacity = "0.8";
                                document.getElementById("WarningResetFinished").style.transition = "visibility 0s, opacity 0.2s ease-in-out";
                                document.getElementById("WarningResetFinished").style.zIndex = "1000";
                                recordExpLog('重置实验完成,水箱已放空');
                            }, 10000);
                        }

                        //记录数据只有在刷新曲线过程中才能进行
                        if(isDrawingGraph)
                        {
                            chartWeight.series[0].addPoint([time, Number(weight)], true, true);
                            chartVortex.series[0].addPoint([time, Number(flowRate)], true, true);

                            time += 1000;
                            var min = parseInt(time/60000);
                            var sec = (time/1000)%60;

                            //如果正在记录表格,则向表格中添加数据
                            if(isRecordingTable)
                            {
                                if(recordIntervalCounter < recordInterval)
                                {
                                    recordIntervalCounter++;
                                }
                                else
                                {
                                    recordIntervalCounter = 1;
                                    recordingIndex++;
                                    //添加表格标题行
                                    var row = document.getElementById("tableDataRecord").insertRow();
                                    var cell;
                                    cell = row.insertCell(-1);
                                    cell.innerHTML =  recordingIndex;
                                    cell.align = "center";

                                    cell = row.insertCell(-1);
                                    cell.innerHTML = (((min<10)?"0":"") + min + ":" + ((sec<10)?"0":"") + sec);
                                    cell.align = "center";

                                    cell = row.insertCell(-1);
                                    cell.innerHTML = weight;
                                    cell.align = "center";

                                    cell = row.insertCell(-1);
                                    cell.innerHTML = flowRate;
                                    cell.align = "center";

                                    document.getElementById("divDataTable").scrollTop = cell.offsetTop;
                                }
                            }
                            else
                            {recordIntervalCounter = recordInterval;}
                        }

                    }
                });

                socket.on("Error", function(error){
                    if(error=="Overflow")
                    {
                        document.getElementById("WarningOverflow").style.visibility = "visible";
                        document.getElementById("WarningOverflow").style.opacity = "0.8";
                        document.getElementById("WarningOverflow").style.transition = "visibility 0s, opacity 0.2s ease-in-out";
                        document.getElementById("WarningOverflow").style.zIndex = "1000";
                        recordExpLog('错误:上储水箱溢出');
                    }
                });
            </script>

        <script>
            $('#sw1').click(function ()
                {socket.emit('controlValves', 'in', document.getElementById('sw1').checked); recordExpLog(document.getElementById('sw1').checked?'打开进水阀':'关闭进水阀');})
            $('#sw2').click(function ()
                {socket.emit('controlValves', 'side', document.getElementById('sw2').checked); recordExpLog(document.getElementById('sw2').checked?'打开侧阀':'关闭侧阀');})
            $('#sw3').click(function ()
                {socket.emit('controlValves', 'out',document.getElementById('sw3').checked); recordExpLog(document.getElementById('sw3').checked?'打开出水阀':'关闭出水阀');})

            //Pump controlling
            $('#sw4').click(function ()
            {
                if(document.getElementById('sw4').checked)
                    socket.emit('controlPump', document.getElementById('frequencySlider').value);
                else
                    socket.emit('controlPump', 0);
                recordExpLog(document.getElementById('sw4').checked?('开启变频器,频率:'+document.getElementById('frequencySlider').value+'Hz'):'关闭变频器');
            })
            $('#frequencySlider').change(function (){
                updateFrequencyValue();
                if(document.getElementById('sw4').checked)
                {
                    socket.emit('controlPump', document.getElementById('frequencySlider').value);
                    recordExpLog('调节变频器频率:'+document.getElementById('frequencySlider').value+'Hz');
                }
            })

            function updateFrequencyValue()
            {
                //改变滑动条外观
                document.getElementById("sValidRange").style.width=document.getElementById("frequencySlider").value * 3 + "px";
                document.getElementById('labelFrequency').innerHTML = document.getElementById('frequencySlider').value + ' Hz';
                document.getElementById('labelFrequencySide').innerHTML = document.getElementById('frequencySlider').value + ' Hz';

            }
        </script>

        <script src="javascripts/bootstrap.js"></script>
    </div>


</body>

</html>